sys = require 'sys'
ejs = require 'ejs'
fs = require 'fs'

class Nor.ControllerBase
  
  constructor: (@env) ->
    @rendered = false
    
  params: (key = null)->
    if key?
      @env.params[key]
    else
      @env.params
  
  render: (options = {}) ->
    if options['layout'] is undefined
      options['layout'] = 'layouts/application.ejs'
    @env.writeHead(options['status'] ||= 200, 'Content-Type': options['Content-Type'] ||= 'text/html')
    if options['text']
      @rendered = options['text']
    else
      view_name = options['view'] ||= "#{@env.controller_name}/#{@env.action_name}.ejs"
      engine = new Nor.ViewRenderer(view_name, options)
      @rendered = engine.render(self: @, env: @env, params: @params)
    
    @rendered