sys = require 'sys'
ejs = require 'ejs'
fs = require 'fs'

class Nor.ControllerBase
  
  constructor: (@env) ->
    
  params: (key = null)->
    if key?
      @env.params[key]
    else
      @env.params
  
  render: (options = {}) ->
    @env.writeHead(options['status'] ||= 200, 'Content-Type': options['Content-Type'] ||= 'text/html')
    if options['text']
      @env.write(options['text'])
    else
      view_name = options['view'] ||= "#{@env.controller_name}/#{@env.action_name}.ejs"
      engine = new Nor.ViewRenderer(view_name, options)
      @env.write(engine.render(self: @, env: @env, params: @params))