sys = require 'sys'

class Nor.Middleware.Router
    
  @process: (env) ->
    for route in Nor.routes.routes[env.method]
      if route.matches env.url
        event.preventDefault() if event?
        route.exec env
        return env
    @routeNotFound env
    
  @routeNotFound: (env) ->
    env.res.writeHead(env._meta.status = 404, 'Content-Type': 'text/html')
    view_name = "404.ejs"
    engine = new Nor.ViewRenderer(view_name, layout: false)
    env.write(engine.render(self: @, env: env))
    return env
    
Nor.Middleware._list.push () ->
  Nor.Middleware.Router